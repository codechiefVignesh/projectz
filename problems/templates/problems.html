<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problems - CodePlatform</title>
    <meta name="description" content="Browse and solve coding problems">
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="{% static 'problems/style-new.css' %}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">CodePlatform</a>
            <div class="nav-icons">
                {% if user.is_superuser %}
                    <a href="{%url 'approve-users'%}" class="nav-icon" title="Approved">
                        <svg fill="currentColor" width="20" height="20" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414L8.414 15l-4.121-4.121a1 1 0 111.414-1.414L8.414 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </a>
                {% endif %}
                <a href="{% url 'add_problem' user.id %}" class="nav-icon" title="Add Problem">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"/>
                    </svg>
                </a>
                <a href="{% url 'user-details' user.id %}" class="nav-icon" title="Profile">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                    </svg>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Welcome Section -->
        <div class="welcome-section">
            <div class="welcome-content">
                <h1>Welcome back, {{user.firstname}}!</h1>
                <p class="user-info">{{user.firstname}} {{user.lastname}} â€¢ Member since {{user.join_date|date:"F Y"}}</p>
            </div>
            <div class="welcome-visual">
                <div class="code-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16,18 22,12 16,6"></polyline>
                        <polyline points="8,6 2,12 8,18"></polyline>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Problems Section -->
        <div class="section-header">
            <div class="header-content">
                <h2 class="section-title">Practice Problems</h2>
                <span class="problem-count">{{ problems|length }} problems</span>
            </div>
            <div class="filter-tabs">
                <button class="tab active" data-filter="all">All</button>
                <button class="tab" data-filter="Easy">Easy</button>
                <button class="tab" data-filter="Medium">Medium</button>
                <button class="tab" data-filter="Hard">Hard</button>
                <button class="tab" data-filter="solved">Solved</button>
            </div>
        </div>

        <div class="problems-container">
            {% for problem in problems %}
                <div class="problem-card" data-difficulty="{{ problem.difficulty }}" data-problem-id="{{ problem.id }}" data-solved="{% if problem.id in solved_problem_ids %}true{% else %}false{% endif %}">
                    <div class="card-header">
                        <h3 class="problem-title">
                            {{ problem.title }}
                            {% if problem.id in solved_problem_ids %}
                                <span class="status-solved">
                                    <svg width="16" height="16" fill="#10b981" viewBox="0 0 16 16">
                                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.061L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                    </svg>
                                </span>
                            {% endif %}
                        </h3>
                        <span class="difficulty-badge difficulty-{{ problem.difficulty|lower }}">{{ problem.difficulty }}</span>
                    </div>
                    
                    <p class="problem-description">
                        {{ problem.description|truncatewords:25 }}
                    </p>
                    
                    {% if problem.get_tags_list %}
                        <div class="problem-tags">
                            {% for tag in problem.get_tags_list %}
                                <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <div class="card-footer">
                        <div class="problem-stats">
                            {% if problem.acceptance_rate %}
                                <span class="stat">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                    {{ problem.acceptance_rate }}% accepted
                                </span>
                            {% endif %}
                            {% if problem.submissions %}
                                <span class="stat">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                    {{ problem.submissions }}
                                </span>
                            {% endif %}
                        </div>
                        <button class="solve-btn" data-problem-id="{{ problem.id }}">
                            <span>{% if problem.id in solved_problem_ids %}View Solution{% else %}Solve{% endif %}</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="7" y1="17" x2="17" y2="7"></line>
                                <polyline points="7,7 17,7 17,17"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            {% empty %}
                <div class="empty-state">
                    <div class="empty-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                        </svg>
                    </div>
                    <h3>No problems yet</h3>
                    <p>Be the first to add a coding problem!</p>
                    <a href="{% url 'add_problem' user.id %}" class="empty-action-btn">Add First Problem</a>
                </div>
            {% endfor %}
        </div>
    </div>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                const filter = this.getAttribute('data-filter');
                filterProblems(filter);
            });
        });

        function filterProblems(filter) {
            const problemCards = document.querySelectorAll('.problem-card');
            let visibleCount = 0;
            
            problemCards.forEach(card => {
                let shouldShow = false;
                
                if (filter === 'all') {
                    shouldShow = true;
                } else if (filter === 'solved') {
                    // Check if problem is solved using data attribute
                    const isSolved = card.getAttribute('data-solved') === 'true';
                    shouldShow = isSolved;
                } else {
                    const difficulty = card.getAttribute('data-difficulty');
                    shouldShow = difficulty === filter;
                }
                
                if (shouldShow) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            updateProblemsCount(visibleCount, filter);
        }

        function updateProblemsCount(count, filter) {
            const countElement = document.querySelector('.problem-count');
            if (countElement) {
                const filterText = filter === 'all' ? '' : ` (${filter})`;
                countElement.textContent = `${count} problem${count !== 1 ? 's' : ''}${filterText}`;
            }
        }

        // Problem card interactions
        document.querySelectorAll('.problem-card').forEach(card => {
            card.addEventListener('click', function(e) {
                if (!e.target.closest('.solve-btn')) {
                    const problemTitle = this.querySelector('.problem-title').textContent;
                    console.log('Navigate to problem:', problemTitle);
                    // Add navigation logic here
                }
            });
        });

        // Solve button interactions
        document.querySelectorAll('.solve-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const problemCard = this.closest('.problem-card');
                const problemId = problemCard.getAttribute('data-problem-id');
                const isSolved = problemCard.getAttribute('data-solved') === 'true';
                const userId = {{ user.id }};
                
                if (isSolved) {
                    // Navigate to solution history page
                    window.location.href = `/home/${userId}/problems/${problemId}/solutions/`;
                } else {
                    // Navigate to solve page
                    window.location.href = `/home/${userId}/problems/${problemId}/solve/`;
                }
            });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            const initialCount = document.querySelectorAll('.problem-card').length;
            updateProblemsCount(initialCount, 'all');
        });
    </script>
</body>
</html>