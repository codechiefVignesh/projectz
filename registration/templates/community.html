{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Join Community</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="light">
    <div class="background-decoration"></div>
    
    <div class="theme-toggle">
        <i id="theme-icon" class="fa-solid fa-moon" onclick="toggleTheme()" title="Toggle Theme"></i>
    </div>

    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h1>Create Community Account</h1>
                    <p>Join us and Contribute</p>
                </div>
            </div>
            
            <form method="post" class="auth-form">
                {% csrf_token %}

                <div class="form-group">
                    <label for="id_firstname">
                        <i class="fas fa-user"></i>
                        First Name
                    </label>
                    <div class="input-wrapper">
                        {{ form.firstname }}
                    </div>
                    {% if form.firstname.errors %}
                        <div class="field-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ form.firstname.errors.0 }}</span>
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="id_lastname">
                        <i class="fas fa-user"></i>
                        Last Name
                    </label>
                    <div class="input-wrapper">
                        {{ form.lastname }}
                    </div>
                    {% if form.lastname.errors %}
                        <div class="field-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ form.lastname.errors.0 }}</span>
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="id_email">
                        <i class="fas fa-envelope"></i>
                        Email Address
                    </label>
                    <div class="input-wrapper">
                        {{ form.email }}
                    </div>
                    {% if form.email.errors %}
                        <div class="field-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ form.email.errors.0 }}</span>
                        </div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="id_password">
                        <i class="fas fa-lock"></i>
                        Password
                    </label>
                    <div class="input-wrapper">
                        {{ form.password }}
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye" id="password-eye"></i>
                        </button>
                    </div>
                    <div id="pwd-message" class="password-strength"></div>
                    {% if form.password.errors %}
                        <div class="field-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ form.password.errors.0 }}</span>
                        </div>
                    {% endif %}
                </div>

                <div class="form-options">
                    <label class="terms-agreement">
                        <input type="checkbox" name="agree_terms" required>
                        <span class="checkmark"></span>
                        I agree to the <a href="#" class="auth-link">Terms & Conditions</a>
                    </label>
                </div>
                <div class="form-options">
                    <label class="terms-agreement">
                        <input type="checkbox" name="is_community_user" id="id_is_community_user">
                        <span class="checkmark"></span>
                        Join as a <strong>Community Contributor</strong>
                    </label>
                </div>

                <button type="submit" class="auth-btn">
                    <span>Create Account</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Already a Contributer? 
                    <a href="{% url 'login' %}" class="auth-link">Sign In</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                body.classList.add('light');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light');
                body.classList.add('dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            }
        }

        function togglePassword() {
            const passwordField = document.querySelector('input[type="password"]');
            const eyeIcon = document.getElementById('password-eye');
            
            if (passwordField && passwordField.type === 'password') {
                passwordField.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else if (passwordField) {
                passwordField.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }

        function validatePassword(password) {
            const checks = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /\d/.test(password),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };

            const strength = Object.values(checks).filter(Boolean).length;
            
            return {
                checks,
                strength,
                isValid: strength >= 3 && checks.length
            };
        }

        function updatePasswordStrength(password) {
            const pwdMessage = document.getElementById("pwd-message");
            const validation = validatePassword(password);
            
            if (password.length === 0) {
                pwdMessage.innerHTML = '';
                return;
            }

            let strengthText = '';
            let strengthClass = '';
            
            if (validation.strength <= 2) {
                strengthText = `
                    <div class="strength-indicator weak">
                        <div class="strength-bar"></div>
                        <span>Weak Password</span>
                    </div>
                    <div class="strength-tips">
                        ${!validation.checks.length ? '<span>• At least 8 characters</span>' : ''}
                        ${!validation.checks.uppercase ? '<span>• One uppercase letter</span>' : ''}
                        ${!validation.checks.number ? '<span>• One number</span>' : ''}
                    </div>
                `;
                strengthClass = 'weak';
            } else if (validation.strength <= 3) {
                strengthText = `
                    <div class="strength-indicator medium">
                        <div class="strength-bar"></div>
                        <span>Medium Strength</span>
                    </div>
                `;
                strengthClass = 'medium';
            } else {
                strengthText = `
                    <div class="strength-indicator strong">
                        <div class="strength-bar"></div>
                        <span>Strong Password</span>
                        <i class="fas fa-check"></i>
                    </div>
                `;
                strengthClass = 'strong';
            }
            
            pwdMessage.innerHTML = strengthText;
            pwdMessage.className = `password-strength ${strengthClass}`;
        }

        // Load saved theme and setup
        window.onload = () => {
            const theme = localStorage.getItem('theme') || 'light';
            const icon = document.getElementById('theme-icon');
            document.body.classList.remove('light', 'dark');
            document.body.classList.add(theme);
            if (theme === 'dark') {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }

            // Setup password validation
            const pwdInput = document.getElementById("id_password");
            if (pwdInput) {
                pwdInput.addEventListener("input", (e) => {
                    updatePasswordStrength(e.target.value);
                });
            }

            // Add smooth entrance animation
            const card = document.querySelector('.auth-card');
            if (card) {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 100);
            }
        };
    </script>

</body>
</html>